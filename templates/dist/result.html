<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Web3 Jobs Bot</title>
    <meta name="theme-color" content="#ffffff " />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.min.css" />
    <script src="./js/script.min.js" defer></script>
  </head>
  <body>
    <div class="wrapper">


      <main class="main">
        <div class="main__inner">
          <section class="result">
            <div class="result__img">
              <img src="./icons/rocket.svg" alt="rocket" />
            </div>
            <h2 class="title">Great! Look what we found for you:</h2>
            <div class="result__block">
              <div class="result__block--list">
                <p id="jobs">1,223</p>
                <span>job offers</span>
              </div>
              <div class="result__block--list">
                <span>from</span>
              </div>
              <div class="result__block--list">
                <p id="companies">987</p>
                <span>companies</span>
              </div>
            </div>
          </section>
        </div>
      </main>

      <a href="./subscribtion.html" class="btn">Start your 5-day free trial</a>

    </div>
  </body>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    let telegram_id = tg.initDataUnsafe.user.id;
  </script>
  <script>
  async function updateCounts() {
    const response = await fetch(`https://web3jobs.online/get_count_vacancies?telegram_id=${telegram_id}&result=1`);
    if (response.ok) {
        const data = await response.json();

        const jobCountElement = document.getElementById('jobs');
        const companyCountElement = document.getElementById('companies');

        jobCountElement.textContent = data.job_count;
        companyCountElement.textContent = data.company_count;
    } else {
        console.error('Ошибка при получении данных с сервера');
    }
  }
  window.addEventListener('load', updateCounts);
  
  </script>
  <script>
document.addEventListener("DOMContentLoaded", function () {
        const startTrialButton = document.querySelector(".btn");

        startTrialButton.addEventListener("click", function (event) {
          event.preventDefault(); // Предотвращаем стандартное действие ссылки

          extendSubscription();
        });
      });

      async function extendSubscription() {
        try {

          const response = await fetch('/extend_subscription', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ telegram_id: telegram_id })
          });

          if (!response.ok) {
            throw new Error('Failed to extend subscription');
          }

          const data = await response.json();

          if (data.success) {
            window.location.href = './jobs.html';
          } else {
            window.location.href = './subscribtion.html';
          }
        } catch (error) {
          console.error('Error:', error.message);
          alert('Failed to extend subscription. Please try again later.');
        }
      }

  </script>
</html>
